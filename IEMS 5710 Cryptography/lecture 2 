
Suô°šmmaryô°› of Today'ô°›ô°œs Lectuô°šre
â€¢ Stream Ciphers
    o Basic Idea and Definition
    o Perfect Security, Secure PRG, Semantic Security (one-time key)
    
â€¢ Block Ciphers
    o Definition and Principles, DES, Triple-DES, AES
    o Secure PRF and PRP, Semantic Security (many-time key): CPA Security
    
â€¢ Encryption Schemes
    o Encryption Mode: ECB, CBC, CTR; Padding
    o Programming practice using OpenSSL
    
    
Ciphers and Encryption Schemes

Ciphers are not encryption schemes; they are used to build encryption schemes.

Qï¼šAre DES/AES and RSA ciphers or encryption schemes?
Aï¼šDES/AES and RSA are ciphers
ï¼ˆè¿™é‡Œæˆ‘ä¸€å¼€å§‹ä¹Ÿç†è§£é”™è¯¯äº†ï¼Œè¿™é‡Œçš„cipheråº”è¯¥æ˜¯åŠ å¯†çš„ä¸€ç§ç®—æ³•ï¼Œè€Œencryption scheme å¯èƒ½æ˜¯åŒ…å«æ•´å¥—çš„åŠ å¯†æµç¨‹ï¼Œåç»­çœ‹çœ‹å¯ä¸å¯ä»¥å†è¡¥å……ç†è§£ä¸€ä¸‹ï¼‰


Stream Ciphers:
    About Stream Ciphers, one-time key and Perfect Security what we have already mentioned in Lecture 1.
    we will add the following knowledge points what we didn't mention before in lecture 1.

     o Pseudorandom Generator (PRG)
     It takes a short, truly random secret seed/key K and expands it into a longer "random-looking" sequence.
     ï¼ˆå®é™…ä¸Šä¼ªéšæœºæ•°ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„éšæœºæ•°ï¼Œæ˜¯æœºå™¨é€šè¿‡å¤æ‚è¿ç®—å»å°½å¯èƒ½çš„æ¨¡æ‹ŸçœŸå®çš„éšæœºæƒ…å†µï¼‰
     Q:How to judge whether a pseudo-random number is qualifiedï¼Ÿ
     A program is intelligent if its input/output behavior is indistinguishable from that of a human.
        ï¼ˆå°±æ˜¯çœ‹è¿™ä¸ªç¨‹åºçš„è¾“å…¥è¾“å‡ºæ˜¯ä¸æ˜¯å’Œäººç±»çš„è¡Œä¸ºæ²¡æœ‰åŒºåˆ«ï¼‰
        Measure of the intelligence of a program is the extent the tester fails to tell the difference
    
     In practice
            o Adv >=ô°Ÿ pow(2,-30) is non-negligible; Adv <=ô°  pow(2,-80) is negligible
            (ä¸è¦é—®æˆ‘ä¸­é—´çš„åŒºé—´æ€ä¹ˆåŠï¼Œè€å¸ˆä¹Ÿä¸çŸ¥é“ğŸ˜‚)
            ï¼ˆAdvæ˜¯æŒ‡æœºå™¨å’Œäººå‡ºç°åŒä¸€è¡Œä¸ºçš„å¯èƒ½æ€§çš„å·® Adv = |Pr(A(G(k))) = 1ï¼‰- Pr(A(r) = 1)|  A() is algorithm A())
    
      o Semantic Security
        Definition:
            E is semantically secure (one-time key) if for all efficient algorithms A
             Adv = |Pr(A(G(k))) = 1ï¼‰- Pr(A(r) = 1)| is negligible(å°±æ˜¯è¿™ä¸ªadvè¿™ä¸ªå€¼å¯ä»¥å¿½ç•¥)
             
        ï¼ˆIn my conclusion, å½“adv = 0 æ—¶ï¼ŒSemantic Security is same as Perfect Securityï¼‰
 
 
        
 Block Ciphers:
     â€¢ Examples of Block Ciphers:
         o DES: Data Encryption Standardï¼ˆDES çš„å…³é”®æ˜¯ Feistel cipher ï¼‰
                â€¢ DES is a block cipher - can encrypt only a block of data
                â€¢ Block size for DES is 64 bits
                â€¢ DES uses 56-bit keys
                â€¢ 16 rounds in total
                 DES çš„å…³é”®æ˜¯ Feistel cipher
                 æ˜æ–‡æ‹†æˆå·¦å³ (L0) (R0) ä¸¤ä¸ªéƒ¨åˆ†ç„¶åç”¨ä¸€ç»„å­å¯†é’¥ (K1)ä¸æ–­çš„å¼‚æˆ–ã€äº¤æ¢ ï¼ˆFeistel functionï¼‰
                 é‚£è¿™ä¸ª K1 æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ-> æ˜¯ç”±åˆå§‹å¯†é’¥ K é€šè¿‡ä¸€äº›åˆ—æ“ä½œå˜æˆ 56bit K å†é€šè¿‡æ‹†åˆ†æˆå·¦å³28bitçš„ä¸¤éƒ¨åˆ†å¾ªç¯ä½ç§» åœ¨é€šè¿‡PC-2å‹ç¼©ç½®æ¢ -> å˜æˆ48bit K1
                
                  Triple-DES
                â€¢ Tripleâ€”DES can solve DES's key size problem
                â€¢ C = E(K1, D(K2, E(K3, M)))
                â€¢ If K1ô°¨ != K2ô°¨ != K3, it is called 3DES3
                â€¢ If K1=K3, it is called 3DES2
                â€¢ If K1=K2 =K3, it can work with single DES, backward compatible


         o AES: Advanced Encryption Standard
             â€¢ 2001: Rijndael (by Rijmen and Daemen) selected as the AES
                 o Block size: 128 bits
                 o Key sizes: 128, 192, 256 bits corresponding to 10, 12, and 14 rounds
                 
                 åŸç†
                 AES å°†è¦åŠ å¯†çš„æ–‡ä»¶ åˆ†ä¸º N ä¸ª16bytesçš„ 128bitsæ•°æ®ï¼ˆ1byte = 8 bitsï¼‰
                 AESçš„å†…éƒ¨å¹¶ä¸ç›´æ¥ä½¿ç”¨æä¾›çš„å¯†é’¥ K ï¼Œè€Œæ˜¯é€šè¿‡å¯†é’¥ç¼–æ’(Key Schedule)æ¥äº§ç”Ÿå­å¯†é’¥k1,k2...kr
                 å­å¯†é’¥çš„æ•°é‡æ¯”æ“ä½œè½®æ•° r(round) å¤š1, r ç”±å¯†é’¥çš„é•¿åº¦ K æ¥å†³å®šï¼Œå¦‚ä¸Šæ–‡æ‰€æ.
                 ç„¶åé€šè¿‡ (1) ByteSubï¼ˆByte Substitution å­—èŠ‚ä»£æ¢ï¼‰ ô°
                         (2) ShiftRowï¼ˆè¡Œä½ç§»ï¼‰
                         ô°(3) MixColumnï¼ˆåˆ—æ··åˆï¼‰
                 åœ¨æœ€åä¸€è½®ä¸­ï¼Œä¸åšMixColumnæ“ä½œã€‚
                   ï¼ˆè¿™é‡Œå…³äºAESçš„å…·ä½“è®¡ç®— æˆ‘è§‰å¾—å¹¶ä¸é‡è¦ğŸ¶ ç›®å‰ä¸æƒ³æ·±ç©¶ è¯¦ç»†è®²è§£ ï¼šhttps://zhuanlan.zhihu.com/p/41716899 è¿™é‡Œè‡ªå–ï¼‰
                
                
    â€¢ Secure PRF and PRP
        Pseudo Random Function (PRF) and Pseudo Random Permutation (PRP)
        è€å¸ˆè¯´ No need to read/remember these definitions. What you need to know is ...
        
        F: KxX -> ô°Y is a secure PRF if the advantage
        â€¢ AdvPRF(A, F) = |Pr[A(PRF) =1] -   Pr[A(Rand) =1]| is negligible for all efficient algorithms A.
            æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œå’Œä¸Šé¢è¯­ä¹‰å®‰å…¨çš„å…¬å¼å‡ ä¹æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ ç†è§£æ–¹å¼ä¹Ÿæ˜¯åŒä¸Š
             Secure PRP can be defined similarly
             
        â€¢ Secure PRP = Secure Block Cipher.
        This is the single master property of block ciphers
        
        â€¢ We currently have no proof that any secure PRG, PRP, PRF exists.(G: generator, P: permutation)
            What we can do is to give some conditions, we can prove secure or not.
        
        â€¢ Conjectures:
            o DES, AES are good block ciphers in the sense of being secure PRPs to the maximum extent possible given their key and block lengths.

    â€¢ Semantic Security (Many-Time Key)
        â€¢ CPA (chosen plaintext attack) security ï¼ˆé€‰æ‹©æ˜æ–‡æ”»å‡»ï¼‰
            o Encryption is secure against eavesdropping only
            o Adversary can obtain encryption of arbitrary messages of his choice
        â€¢ CCA (chosen ciphertext attack) securityï¼ˆé€‰æ‹©å¯†æ–‡æ”»å‡»ï¼‰
            o Encryption is secure against active attacks
            o Adversary can obtain encryption of arbitrary messages of his choice and can decrypt any ciphertext of his choice except a target ciphertext .
            o Will not be covered in this course.ï¼ˆè€å¸ˆä¸è®² æœ‰æœºä¼šæ›´æ–°å§ï¼‰

    â€¢ CPA Security Definition: CPA Experiment
            Encryption scheme(K,E,D) is CPA secure if for all efficient A,
            the advantage -> AdvCPA(A, E) = |Pr[A(EXP(0))=1] ô°¢ Pr[A(EXP(1))=1]| is negligible.



Encryption Schemesï¼š
    â€¢ Encryption Mode
            â€¢ M is a (padded) message of any length o M = m1|m2ô°²ô°¬ô°²ô°|..|mi where mi is n bits
            â€¢ ci = E(k, mi) is block cipher encryption of the n-bit block mi
            â€¢ C = Eâ€˜(k, M) is a symmetric encryption (scheme) of M
                ï¼ˆè¿™é‡Œçš„Eâ€™ä¸æ˜¯ä¸Šé¢çš„E æ˜¯æ•´ä¸ªencryption scheme æˆ‘è¿™é‡Œæ•…æ„åŠ ä¸Š â€˜ åŒºåˆ†ï¼‰
        
        Divide plaintext into blocks with size of 64-bit or 128-bit,
        but how to connect these blocks during encryption?
        
        â€¢ ECB, CBC, CTR;
            o ECB: Electronic Code Book Mode ï¼ˆç”µç æœ¬æ¨¡å¼ï¼‰
                ç”µç æœ¬æ„Ÿè§‰å°±æ˜¯æŒ‰ç…§é¡ºåºæ¥çš„ å°†Måˆ†æˆ m1|m2|..|mi å†æŒ‰ç…§é¡ºåºåŠ å¯† -> c1|c2|..|ci ->è§£å¯†æ—¶å€™ä¹ŸæŒ‰ç…§é¡ºåºè§£å¯†å°±è¡Œäº†
                Divide M into i blocks then encrypt them into c1|c2|..|ci in order

              ECB Weakness : If M1 = M2 then C1 = C2.
              å®¹æ˜“æš´éœ²æ˜æ–‡çš„æ•°æ®æ¨¡å¼ï¼Œå› æ­¤ECBå®¹æ˜“é­å—é‡æ”¾æ”»å‡»
              ECBåœ¨ç”¨äºçŸ­æ•°æ®(å¦‚åŠ å¯†å¯†é’¥)æ—¶éå¸¸ç†æƒ³ï¼Œæ—¢é«˜æ•ˆåˆå®‰å…¨ï¼Œå› æ­¤å¦‚æœéœ€è¦å®‰å…¨åœ°ä¼ é€’DESå¯†é’¥ï¼ŒECBæœ€åˆé€‚ä¸è¿‡äº†
              
            o CBC: Cipher Block Chaining Mode
                å®ƒä¸€æ¬¡ä½¿ç”¨åŒä¸€å¯†é’¥å¯¹ä¸€ä¸ªæ˜æ–‡åˆ†ç»„åŠ å¯†ï¼ŒåŠ å¯†ç®—æ³•çš„è¾“å…¥æ˜¯å½“å‰æ˜æ–‡åˆ†ç»„å’Œå‰ä¸€æ¬¡å¯†æ–‡åˆ†ç»„çš„å¼‚æˆ–
                for example E(k,mi XOR ci-1) ï¼ˆæœ‰ä¸€ä¸ª IVä½œä¸ºc0 Initialization Vectorï¼‰
              
              CBC Weakness :
              åŠ å¯†ä¸èƒ½å¹¶è¡Œï¼Œå› ä¸ºæ¯ä¸€ä¸ª mi åŠ å¯†éƒ½éœ€è¦ä¾èµ–äºå‰é¢ä¸€ä¸ªmi-1
              å¦‚æœä¸€ä¸ªå¯†æ–‡åˆ†ç»„æŸå å°±ä¼šå½±å“ä¸¤ä¸ªæ˜æ–‡åˆ†ç»„çš„è§£å¯†
            
            
            o CTR: Counter Modeï¼ˆè®¡æ•°å™¨æ¨¡å¼ï¼‰
                CTRæ¨¡å¼æ˜¯ä¸€ç§å°†è®¡æ•°å™¨ä¸æ–­ç´¯åŠ ï¼Œç„¶åè¿›è¡ŒåŠ å¯†ä»è€Œç”Ÿæˆå¯†é’¥æµçš„æµå¯†ç ï¼Œç”¨æµå¯†ç æ¥ä¸ä¸åŒçš„æ˜æ–‡åˆ†ç»„è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·å¯ä»¥å¹¶è¡ŒåŠ å¯†å¹¶ä¸”å¯ä»¥è§£å¯†çš„æµç¨‹å’ŒåŠ å¯†ä¸€æ ·ï¼Œæ–¹ä¾¿è®¾è®¡
                â€¢ Q:How to get ctr?
                â€¢ We follow the principle that (k, ctr) should never repeat.
                    â€¢ it basically uses a counter to generate the key streams.
                    â€¢ Since no key stream can be reused, the counter value for each block is prepended with a randomly generated value called nonce.
                    â€¢ This nonce serves the same role as the IV does to the other encryption modes.
                    â€¢ Both encryption and decryption can be parallelized.
        
        
        â€¢ Padding:
                â€¢ åˆ†ç»„åŠ å¯†å°†æ˜æ–‡åˆ†æˆblockï¼Œæ¯ä¸€å—çš„blockå¿…é¡»æ»¡è¶³ cipher's block size, ä½†æ˜¯the last plaintext block ä¸ä¸€å®šèƒ½ match cipher's block size
                â€¢ Last block of the plaintext needs padding æœ€åä¸€å—æ˜æ–‡éœ€è¦è¢«â€œæ‹¼å‡‘â€ä¸Šå»
                â€¢ Padding schemes need to clearly mark where the padding starts, so decryption can remove the padded data
